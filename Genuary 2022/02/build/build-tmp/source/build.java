/* autogenerated by Processing revision 1276 on 2022-01-02 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class build extends PApplet {

// Genuary 2022 - Day 02
// Dithering
String  pathDATA 	= "../../../0_data/";
int[] palette 	= {0xFF2E294E,0xFFF1E9DA,0xFF541388,0xFFFFD400,0xFFD90368};
int  	bg 			= palette[0];
int  	fg 			= palette[1];
PImage 	img;
 public void setup() {
	/* size commented out by preprocessor */;
	img = loadImage(pathDATA + "photo/fish.png");
	// img.filter(GRAY);
	image(img, 0, 0, width / 2, height);
}
 public void draw() {
	img.loadPixels();
	for (int y = 0; y < img.height - 1; y++) {
		for (int x = 1; x < img.width - 1; x++) {
			
			int   factor = 1;
			int pix = img.pixels[index(x, y)];

			float oldR = red(pix);
			float oldG = green(pix);
			float oldB = blue(pix);

			int   newR = round(factor * oldR / 255) * (255 / factor);
			int   newG = round(factor * oldG / 255) * (255 / factor);
			int   newB = round(factor * oldB / 255) * (255 / factor);

			img.pixels[index(x, y)] = color(newR, newG, newB);

			float errR = oldR - newR;
			float errG = oldG - newG;
			float errB = oldB - newB;

			int   index = index(x + 1, y    );
			int c = img.pixels[index];
			float r = red(c);
			float g = green(c);
			float b = blue(c);
			r = r + errR * 7 / 16.0f;
			g = g + errG * 7 / 16.0f;
			b = b + errB * 7 / 16.0f;
			img.pixels[index] = color(r, g, b);

			index = index(x - 1, y + 1);
			c = img.pixels[index];
			r = red(c);
			g = green(c);
			b = blue(c);
			r = r + errR * 3 / 16.0f;
			g = g + errG * 3 / 16.0f;
			b = b + errB * 3 / 16.0f;
			img.pixels[index] = color(r, g, b);

			index = index(x, 	y + 1);
			c = img.pixels[index];
			r = red(c);
			g = green(c);
			b = blue(c);
			r = r + errR * 5 / 16.0f;
			g = g + errG * 5 / 16.0f;
			b = b + errB * 5 / 16.0f;
			img.pixels[index] = color(r, g, b);

			index = index(x + 1, y + 1);
			c = img.pixels[index];
			r = red(c);
			g = green(c);
			b = blue(c);
			r = r + errR * 1 / 16.0f;
			g = g + errG * 1 / 16.0f;
			b = b + errB * 1 / 16.0f;
			img.pixels[index] = color(r, g, b);

		}
	}
	img.updatePixels();
	image(img, width / 2, 0, width / 2, height);
}

 public int index (int x, int y) {
	return x + y * img.width;
}


  public void settings() { size(1200, 600); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "build" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
